<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Print Maps, Draw on Them, Scan Them Back In • mapscanner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Print Maps, Draw on Them, Scan Them Back In">
<meta property="og:description" content="Print maps, draw on them, scan them back in, and convert to spatial
    objects.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mapscanner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="articles/index.html">Vignettes</a>
</li>
<li>
  <a href="reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mpadge/mapscanner">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="mapscanner" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#mapscanner" class="anchor"></a>mapscanner <img src="http://www.textfiles.com/underconstruction/CoColosseumHoop5020underconstruction_blk.gif">
</h1></div>
<!-- badges: start -->

<div id="what-does-this-package-do-for-me" class="section level2">
<h2 class="hasAnchor">
<a href="#what-does-this-package-do-for-me" class="anchor"></a>What does this package do for me?</h2>
<p><code>mapscanner</code> is an <strong>R</strong> package that enables lines drawn by hand on maps to be converted to spatial objects. The package has two primary functions: one for producing maps, and one for rectifying hand-drawn lines to the coordinate system of the original map. The package is intended for use in social surveys and similar endeavours in which hand-drawn markings on maps need to be converted to spatial objects. Maps can be either paper- or screen-based. Markings on paper maps need to be scanned, photographed, or otherwise digitised, while maps with screen-based markings need to be saved as <code>.png</code>-format images. The package is currently <a href="https://github.com/ropensci/software-review/issues/330#event-2513283441">under review</a> at <a href="https://ropensci.org">rOpenSci</a>.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>installation</h2>
<p><code>mapscanner</code> is not (yet) on CRAN. The development version can be installed with</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">remotes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span>(<span class="st">"mpadge/mapscanner"</span>)</a></code></pre></div>
<p>The package can then be loaded for usage in a R session with</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> (mapscanner)</a></code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>usage</h2>
<p>The package is designed to enable the following workflow:</p>
<ol>
<li><p>Generate a map with the <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="reference/ms_generate_map.html">ms_generate_map()</a></code></a> function, which automatically produces both <code>.pdf</code> and <code>.png</code> versions;</p></li>
<li><p>Either print the <code>.pdf</code> version to use as desired in any kind of survey environment, or use either the <code>.pdf</code> or <code>.png</code> versions in digital form for screen-based surveys.</p></li>
<li><p>Draw on the map;</p></li>
<li><p>For paper maps, digitise the drawn-on (from here on, “modified”) map, converting it to either <code>.pdf</code> or <code>.png</code> format; and</p></li>
<li><p>Rectify the modified version against the original via the <a href="https://mpadge.github.io/mapscanner/reference/ms_rectify_maps.html"><code><a href="reference/ms_rectify_maps.html">ms_rectify_maps()</a></code></a> function, which distinguishes individual annotations, and converts each one to a spatial object able to be analysed in any desired manner.</p></li>
</ol>
<div id="practical-tips" class="section level3">
<h3 class="hasAnchor">
<a href="#practical-tips" class="anchor"></a>Practical tips</h3>
<p>The <code>mapscanner</code> package is intended to aid a <em>practical</em> workflow, and so a few practical tips may be recommended here to ensure best results:</p>
<ol>
<li>The original digital files generated with <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="reference/ms_generate_map.html">ms_generate_map()</a></code></a> are necessary to rectify subsequently drawn-on and scanned maps, and so must be retained at all times.</li>
<li>Marks drawn on maps should be <em>coloured</em> – any black or grey markings will be ignored. This has the advantage that individual annotations <em>not</em> intended to be converted to spatial objects (such as unique identification or participant codes) may be made on maps in black or grey.</li>
<li>For drawings of areas, best results will be achieved through ensuring that all lines form closed polygons. While the default <code>type = "hulls"</code> argument should work even when lines are not closed, the <code>type = "polygons"</code> argument will generally produce more accurate results, yet should only be used when all lines form closed polygons (see below for details on how these two differ).</li>
<li>Digitised versions of paper maps should contain <em>white</em> borders, so do not, for example, photograph modified maps lying on dark surfaces. If maps are to be photographed, then best results can be achieved by simply placing them on a larger, enclosing sheet of white paper.</li>
</ol>
<p>The following two sections describe the two primary functions of the <code>mapscanner</code> package, corresponding to the two primary steps of producing maps to be used in surveys (or other activities), and rectifying modified maps against these originals in order to extract spatial objects. The second of these sections also describes the kinds of markings able to be recognised, and the kinds of spatial objects to which these may be converted.</p>
</div>
<div id="mapbox-api-tokens" class="section level3">
<h3 class="hasAnchor">
<a href="#mapbox-api-tokens" class="anchor"></a>Mapbox API tokens</h3>
<p>Map generation with <code>mapscanner</code> requires a personal token or key from <a href="https://mapbox.com"><code>mapbox</code></a>, which can be obtained by following the links from <a href="https://docs.mapbox.com/api/#access-tokens-and-token-scopes">https://docs.mapbox.com/api</a>. If you already have a token, the easiest way to use it with <code>mapscanner</code> is to create (or edit) a file <code>~/.Renviron</code>, and insert a line,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="va">MAPBOX_TOKEN=</span><span class="op">&lt;</span><span class="ex">my_mapbox_token</span><span class="op">&gt;</span></a></code></pre></div>
<p>This will then be available every time you start R, without any need to explicitly set the token each time you want to use the package. The token may be given any unique name that includes “mapbox” (case insensitive). Alternatively, if you wish to keep your token truly private, and only use it for your current R session, you may load <code>mapscanner</code>, and then run <code>set_mapbox_token(&lt;my_mapbox_token&gt;)</code>.</p>
</div>
<div id="map-generation" class="section level3">
<h3 class="hasAnchor">
<a href="#map-generation" class="anchor"></a>Map generation</h3>
<p>Having obtained and set a <a href="https://mapbox.com"><code>mapbox</code></a> token as described above, <code>mapscanner</code> may then be used to generate maps. The package comes with a sample map of Omaha, Nebraska, USA, and one with some red lines drawn on it: <img src="./man/figures/omaha-polygons.png"></p>
<p>That’s just a standard <code>png</code> image with no notion of geographical coordinates. The original map was generated with</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">bbox &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="op">-</span><span class="fl">96.12923</span>, <span class="fl">-96.01011</span>),</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">               <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="fl">41.26145</span>, <span class="fl">41.32220</span>)) <span class="co"># portion of omaha</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="reference/ms_generate_map.html">ms_generate_map</a></span> (bbox, <span class="dt">max_tiles =</span> 16L, <span class="dt">mapname =</span> <span class="st">"omaha"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">#&gt; Successfully generated 'omaha.pdf' and 'omaha.png'</span></a></code></pre></div>
<p>As indicated, the function generates a map in both <code>.pdf</code> and <code>.png</code> formats. These files must be retained as the “master” maps against which subsequently modified – drawn-over and scanned-in – versions will be rectified.</p>
</div>
<div id="map-rectification" class="section level3">
<h3 class="hasAnchor">
<a href="#map-rectification" class="anchor"></a>Map rectification</h3>
<p>The magic within the <code>mapscanner</code> package happens via the <a href="https://github.com/jonclayden/RNiftyReg"><code>RNiftyReg</code> package</a>, itself primarily intended to align brain scans and other medical images, but which is precisely the tool needed here. The package comes with two sample <code>.png</code> images which can be used to demonstrate map rectification. In the following code, <code>f_modified</code> is the image shown above, modified from the original by drawing a red line around a particular region of Omaha.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">f_orig &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">f_mod &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha-polygons.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">res &lt;-<span class="st"> </span><span class="kw"><a href="reference/ms_rectify_maps.html">ms_rectify_maps</a></span> (f_orig, f_mod, <span class="dt">type =</span> <span class="st">"polygons"</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; ══ mapscanner ══════════════════════════════════════════════════════════════════</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; ✔ Image [/usr/lib/R/library/mapscanner/extdata/omaha.png] reduced in size by factor of 2</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; ❯ Rectifying the two maps ✔ Rectified the two maps  </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; ❯ Estimating optimal signal-to-noise threshold✔ Estimated optimal signal-to-noise threshold</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; ✔ Identified 2 objects</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; ❯ Converting to spatial format ✔ Converted to spatial format</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10">res</a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; Simple feature collection with 2 features and 0 fields</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; geometry type:  POLYGON</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; dimension:      XY</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; bbox:           xmin: -96.11814 ymin: 41.26638 xmax: -96.02722 ymax: 41.30109</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; epsg (SRID):    4326</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;                         geometry</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt; 1 POLYGON ((-96.11589 41.2663...</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt; 2 POLYGON ((-96.03544 41.2927...</span></a></code></pre></div>
<p>The rectification can take quite some time, during which <a href="https://github.com/jonclayden/RNiftyReg"><code>RNiftyReg</code> package</a> is constructing the best transformation of the modified image back on to the original. The result of <code><a href="reference/ms_rectify_maps.html">ms_rectify_maps()</a></code> is a spatial object in <a href="https://cran.r-project.org/package=sf"><code>sf</code></a>-format in which each drawn component is represented as a separate polygon. Finally, we can plot the result as an interactive map using packages like <a href="https://github.com/r-spatial/mapview"><code>mapview</code></a> with the following commands:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> (mapview)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span> (res)</a></code></pre></div>
<p>or <a href="https://github.com/symbolixAU/mapdeck"><code>mapdeck</code></a>, which similarly requires a mapbox token:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> (mapdeck)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">set_token</span> (<span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span> (<span class="st">"&lt;my_mapbox_token&gt;"</span>))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw">mapdeck</span> () <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">    </span><span class="kw">add_polygon</span> (res, <span class="dt">fill_colour =</span> <span class="st">"#ffff00cc"</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">                 <span class="dt">stroke_colour =</span> <span class="st">"#ff0000"</span>, <span class="dt">stroke_width =</span> <span class="dv">20</span>)</a></code></pre></div>
<p><img src="./man/figures/leaflet-1.png"></p>
<p>And our hand-drawn lines shown above have been converted to standard spatial objects able to be analysed in any desired way. See the <a href="https://mpadge.github.io/mapscanner/articles/mapscanner.html">package vignette</a> for more detail of what the <code>mapscanner</code> package can do.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/mpadge/mapscanner">https://​github.com/​mpadge/​mapscanner</a>
</li>
<li>Report a bug at <br><a href="https://github.com/mpadge/mapscanner/issues">https://​github.com/​mpadge/​mapscanner/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> | <a href="https://opensource.org/licenses/BSD-2-Clause">BSD_2_clause</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Mark Padgham <br><small class="roles"> Author, maintainer </small>  </li>
<li>Michael D. Sumner <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/mpadge/mapscanner"><img src="https://travis-ci.org/mpadge/mapscanner.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://ci.appveyor.com/project/mpadge/mapscanner"><img src="https://ci.appveyor.com/api/projects/status/github/mpadge/mapscanner?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://codecov.io/gh/mpadge/mapscanner"><img src="https://codecov.io/gh/mpadge/mapscanner/branch/master/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://www.repostatus.org/#concept"><img src="https://www.repostatus.org/badges/latest/concept.svg" alt="Project Status: Concept"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Mark Padgham, Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
