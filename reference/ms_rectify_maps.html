<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ms_rectify_maps — ms_rectify_maps • mapscanner</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="ms_rectify_maps — ms_rectify_maps" />
<meta property="og:description" content="Rectify two previously scanned-in pdf or png maps with RNiftyReg, and
return the modifications in map_modified as spatial objects in sf
format." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapscanner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mpadge/mapscanner">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>ms_rectify_maps</h1>
    <small class="dont-index">Source: <a href='https://github.com/mpadge/mapscanner/blob/master/R/rectify-maps.R'><code>R/rectify-maps.R</code></a></small>
    <div class="hidden name"><code>ms_rectify_maps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Rectify two previously scanned-in pdf or png maps with <code>RNiftyReg</code>, and
return the modifications in <code>map_modified</code> as spatial objects in <span class="pkg">sf</span>
format.</p>
    </div>

    <pre class="usage"><span class='fu'>ms_rectify_maps</span>(<span class='no'>map_original</span>, <span class='no'>map_modified</span>, <span class='kw'>non_linear</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"polygons"</span>, <span class='kw'>downsample</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>concavity</span> <span class='kw'>=</span> <span class='fl'>0</span>,
  <span class='kw'>length_threshold</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>quiet</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>map_original</th>
      <td><p>File name of the original map without anything drawn over
it (either a <code>.pdf</code> or <code>.png</code>; extension will be ignored).</p></td>
    </tr>
    <tr>
      <th>map_modified</th>
      <td><p>File name of the modified version with drawings (either a
<code>.pdf</code> or <code>.png</code>; extension will be ignored).</p></td>
    </tr>
    <tr>
      <th>non_linear</th>
      <td><p>Integer value of 0, 1, or 2 representing degree of
non-linearity in modified image - see Note.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>Currently either "points", "polygons", or "hulls", where
"points" simply reduces each distinct object to a single, central point;
"polygons" identifies individual groups and returns the polygon representing
the outer boundary of each; and "hulls" constructs convex or concave polygons
around each group.</p></td>
    </tr>
    <tr>
      <th>downsample</th>
      <td><p>Factor by which to downsample <code>type = "polygons"</code>, noting
that polygons initially include every outer pixel of image, so can generally
be downsampled by at least an order or magnitude (<code>n = 10</code>). Higher values
may be used for higher-resolution images; lower values will generally only be
necessary for very low lower resolution images.</p></td>
    </tr>
    <tr>
      <th>concavity</th>
      <td><p>For <code>type = "hulls"</code>, a value between 0 and 1, with 0 giving
convex hulls and 1 giving highly concave hulls.</p></td>
    </tr>
    <tr>
      <th>length_threshold</th>
      <td><p>For <code>type = "hulls"</code>, the minimal length of a segment
to be made more convex. Low values will produce highly detailed hulls which
may cause problems; if in doubt, or if odd results appear, increase this
value.</p></td>
    </tr>
    <tr>
      <th>quiet</th>
      <td><p>If <code>FALSE</code>, display progress information on screen</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <span class="pkg">sf</span> object representing the drawn additions to map_modified.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The <code>non-linear</code> parameter should generally set according to how the
modified maps were digitised. A value of 0 will give fastest results, and
should be used for directly scanned or photocopied images. A value of 1 (the
default) still presumes modified images have been linearly translated, and
will apply affine transformations (rotations, contractions, dilations). This
value should be used when modified images have been photographed (potentially
from an oblique angle). A value of 2 should only be used when modified maps
have somehow been non-linearly distorted, for example through having been
crumpled or screwed up. Rectification with <code>non-linear = 2</code> will likely take
considerably longer than with lower values.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>f_orig</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span> (<span class='st'>"extdata"</span>, <span class='st'>"omaha.png"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"mapscanner"</span>)
<span class='no'>f_mod</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span> (<span class='st'>"extdata"</span>, <span class='st'>"omaha-polygons.png"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"mapscanner"</span>)
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='no'>xy_hull</span> <span class='kw'>&lt;-</span> <span class='fu'>ms_rectify_maps</span> (<span class='no'>f_orig</span>, <span class='no'>f_mod</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"hull"</span>)
<span class='no'>xy_poly</span> <span class='kw'>&lt;-</span> <span class='fu'>ms_rectify_maps</span> (<span class='no'>f_orig</span>, <span class='no'>f_mod</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"polygons"</span>)
<span class='no'>xy_pts</span> <span class='kw'>&lt;-</span> <span class='fu'>ms_rectify_maps</span> (<span class='no'>f_orig</span>, <span class='no'>f_mod</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"points"</span>)
}
<span class='co'># reduce file sizes to 1/4 to speed up these examples:</span>
<span class='no'>f_orig2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span> (<span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span> (), <span class='st'>"omaha.png"</span>)
<span class='no'>f_modified2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span> (<span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span> (), <span class='st'>"omaha-polygons.png"</span>)
<span class='kw pkg'>magick</span><span class='kw ns'>::</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/editing.html'>image_read</a></span> (<span class='no'>f_orig</span>) <span class='kw'>%&gt;%</span>
    <span class='kw pkg'>magick</span><span class='kw ns'>::</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_resize</a></span> (<span class='st'>"25%"</span>) <span class='kw'>%&gt;%</span>
    <span class='kw pkg'>magick</span><span class='kw ns'>::</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/editing.html'>image_write</a></span> (<span class='no'>f_orig2</span>)
<span class='kw pkg'>magick</span><span class='kw ns'>::</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/editing.html'>image_read</a></span> (<span class='no'>f_mod</span>) <span class='kw'>%&gt;%</span>
    <span class='kw pkg'>magick</span><span class='kw ns'>::</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/transform.html'>image_resize</a></span> (<span class='st'>"25%"</span>) <span class='kw'>%&gt;%</span>
    <span class='kw pkg'>magick</span><span class='kw ns'>::</span><span class='fu'><a href='https://docs.ropensci.org/magick/reference/editing.html'>image_write</a></span> (<span class='no'>f_modified2</span>)

<span class='co'># then rectify those files:</span>
<span class='no'>xy_hull</span> <span class='kw'>&lt;-</span> <span class='fu'>ms_rectify_maps</span> (<span class='no'>f_orig2</span>, <span class='no'>f_modified2</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"hull"</span>)</div><div class='output co'>#&gt; <span class='message'>══ mapscanner ══════════════════════════════════════════════════════════════════</span></div><div class='output co'>#&gt; <span class='message'>❯ rectifying the two maps </span></div><div class='output co'>#&gt; <span class='message'>✔ rectifying the two maps </span></div><div class='output co'>#&gt; <span class='message'>❯ extracting drawn objects </span></div><div class='output co'>#&gt; <span class='message'>✔ extracting drawn objects </span></div><div class='output co'>#&gt; <span class='message'>❯ converting to spatial format </span></div><div class='output co'>#&gt; <span class='message'>✔ converting to spatial format </span></div><div class='input'><span class='no'>xy_poly</span> <span class='kw'>&lt;-</span> <span class='fu'>ms_rectify_maps</span> (<span class='no'>f_orig2</span>, <span class='no'>f_modified2</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"polygons"</span>)</div><div class='output co'>#&gt; <span class='message'>══ mapscanner ══════════════════════════════════════════════════════════════════</span></div><div class='output co'>#&gt; <span class='message'>❯ rectifying the two maps </span></div><div class='output co'>#&gt; <span class='message'>✔ rectifying the two maps </span></div><div class='output co'>#&gt; <span class='message'>❯ extracting drawn objects </span></div><div class='output co'>#&gt; <span class='message'>✔ extracting drawn objects </span></div><div class='output co'>#&gt; <span class='message'>❯ converting to spatial format </span></div><div class='output co'>#&gt; <span class='message'>✔ converting to spatial format </span></div><div class='input'><span class='no'>xy_pts</span> <span class='kw'>&lt;-</span> <span class='fu'>ms_rectify_maps</span> (<span class='no'>f_orig2</span>, <span class='no'>f_modified2</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"points"</span>)</div><div class='output co'>#&gt; <span class='message'>══ mapscanner ══════════════════════════════════════════════════════════════════</span></div><div class='output co'>#&gt; <span class='message'>❯ rectifying the two maps </span></div><div class='output co'>#&gt; <span class='message'>✔ rectifying the two maps </span></div><div class='output co'>#&gt; <span class='message'>❯ extracting drawn objects </span></div><div class='output co'>#&gt; <span class='message'>✔ extracting drawn objects </span></div><div class='output co'>#&gt; <span class='message'>❯ converting to spatial format </span></div><div class='output co'>#&gt; <span class='message'>✔ converting to spatial format </span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#note">Note</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Mark Padgham, Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


