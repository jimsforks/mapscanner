<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>mapscanner • mapscanner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="mapscanner">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mapscanner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mpadge/mapscanner">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>mapscanner</h1>
                        <h4 class="author">Mark Padgham and Michael D. Sumner</h4>
            
            <h4 class="date">2019-10-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mpadge/mapscanner/blob/master/vignettes/mapscanner.Rmd"><code>vignettes/mapscanner.Rmd</code></a></small>
      <div class="hidden name"><code>mapscanner.Rmd</code></div>

    </div>

    
    
<div id="what-does-this-package-do-for-me" class="section level2">
<h2 class="hasAnchor">
<a href="#what-does-this-package-do-for-me" class="anchor"></a>What does this package do for me?</h2>
<p><code>mapscanner</code> is an <strong>R</strong> package that enables maps to be printed out, drawn on, scanned back in, and have the drawn components converted to spatial objects. It is intended for use in social surveys and similar endeavours in which printed paper maps are preferred over digital screens, and enables marks drawn by hand on paper maps to be converted to spatial objects. The use of paper maps is often advantageous because (i) they cost much less than computer devices otherwise needed for digital equivalents; and (ii) they may in many situations be deemed to yield more reliable or accurate results through removing the psychological barriers often associated with screen-based surveys.</p>
</div>
<div id="how-do-i-use-it" class="section level2">
<h2 class="hasAnchor">
<a href="#how-do-i-use-it" class="anchor"></a>How do I use it?</h2>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h3>
<p><code>mapscanner</code> is not yet on CRAN, so must be installed with the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">remotes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span> (<span class="st">"mpadge/mapscanner"</span>)</a></code></pre></div>
<p>After that, the library can be loaded with</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> (mapscanner)</a></code></pre></div>
</div>
<div id="usage" class="section level3">
<h3 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h3>
<p>The package is designed to enable the following workflow:</p>
<ol style="list-style-type: decimal">
<li><p>Generate a map with the <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a> function, which automatically produces both <code>.pdf</code> and <code>.png</code> versions;</p></li>
<li><p>Print the <code>.pdf</code> version to use as desired in any kind of survey environment;</p></li>
<li><p>Draw on the map;</p></li>
<li><p>Digitise the drawn-on (from here on, “modified”) map, converting it to either <code>.pdf</code> or <code>.png</code> format; and</p></li>
<li><p>Rectify the modified version against the original via the <a href="https://mpadge.github.io/mapscanner/reference/ms_rectify_maps.html"><code><a href="../reference/ms_rectify_maps.html">ms_rectify_maps()</a></code></a> function, which distinguishes individual annotations, and converts each one to a spatial object able to be analysed in any desired manner.</p></li>
</ol>
</div>
<div id="practical-tips" class="section level3">
<h3 class="hasAnchor">
<a href="#practical-tips" class="anchor"></a>Practical tips</h3>
<p>Unlike most software packages, <code>mapscanner</code> is intended to aid a <em>practical</em> workflow, and so a few practical tips may be recommended here to ensure best results:</p>
<ol style="list-style-type: decimal">
<li>The original digital files generated with <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a> are necessary to rectify subsequently drawn-on and scanned maps, and so must be retained at all times.</li>
<li>Marks drawn on maps should be <em>coloured</em> – any black or grey markings will be ignored. This has the advantage that individual annotations <em>not</em> intended to be converted to spatial objects (such as unique identification or participant codes) may be made on maps in black or grey.</li>
<li>For drawings of areas, care should be taken to ensure all lines form closed polygons; only in cases where this is not possible or practicable, the <code>type = "hulls"</code> argument should be used in map rectification, as described further below.</li>
<li>Digitised versions should contain <em>white</em> borders, so do not, for example, photograph modified maps lying on dark surfaces. If maps are to be photographed, then best results can be achieved by simply placing them on a larger, enclosing sheet of white paper.</li>
</ol>
<p>The following two sections describe the two primary functions of the <code>mapscanner</code> package, corresponding to the two primary steps of producing maps to be used in surveys, and rectifying modified maps against these originals in order to extract spatial objects. The second of these sections also describes the kinds of markings able to be recognised, and the kinds of spatial objects to which these may be converted.</p>
</div>
</div>
<div id="mapbox-api-tokens" class="section level2">
<h2 class="hasAnchor">
<a href="#mapbox-api-tokens" class="anchor"></a>Mapbox API tokens</h2>
<p>Map generation with <code>mapscanner</code> requires a personal token or key from <a href="https://mapbox.com"><code>mapbox</code></a>, which can be obtained by following the links from <a href="https://docs.mapbox.com/api/#access-tokens-and-token-scopes">https://docs.mapbox.com/api</a>. If you already have a token, the easiest way to use it with <code>mapscanner</code> is to create (or edit) a file <code>~/.Renviron</code>, and insert a line,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="va">MAPBOX_TOKEN=</span><span class="op">&lt;</span><span class="ex">my_mapbox_token</span><span class="op">&gt;</span></a></code></pre></div>
<p>This will then be available every time you start R, without any need to explicitly set the token each time you want to use the package. The token may be given any unique name that includes “mapbox” (case insensitive). Alternatively, if you wish to keep your token truly private, and only use it for your current R session, you may load <code>mapscanner</code>, and then run <code>set_mapbox_token(&lt;my_mapbox_token&gt;)</code>.</p>
</div>
<div id="map-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#map-generation" class="anchor"></a>Map generation</h2>
<p>Having obtained and set a <a href="https://mapbox.com"><code>mapbox</code></a> token as described above, the <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a> function can be used to generate printable maps for a specified bounding box in both <code>.pdf</code> and <code>.png</code> formats. Usage is a simple as,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/ms_generate_map.html">ms_generate_map</a></span> (<span class="st">"chennai india"</span>, <span class="dt">mapname =</span> <span class="st">"chennai"</span>)</a></code></pre></div>
<pre><code>## Successfully generated 'chennai.pdf' and 'chennai.png'</code></pre>
<p>The two generated maps are saved in the current working directory (<code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code>). To save maps in alternative locations, the <code>mapname</code> parameter can optionally specify paths. To provide finer control over the scales of maps, precise bounding boxes can also be submitted. To determine desired bounding boxes, we recommend using the <a href="https://openstreetmap.org">‘openstreetmap.org’ website</a>, zooming to a desired area, then clicking the “Export” button. A window will appear which includes the bounding coordinates of the current screen. Even finer control can be gained by clicking beneath this coordinate window on the line which says, “Manually select a different area,” which brings a drag-able rectangle onto the current screen. The coordinates in the bounding box then simply need to be entered in to the <code>bbox</code> parameter of <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a> in the order (<code>xmin</code>, <code>ymin</code>, <code>xmax</code>, <code>ymax</code>) – or anti-clockwise from the left-hand coordinate.</p>
<p>Maps are generated in two formats, because the <code>.pdf</code> version will generally be the most convenient for printing, while the <code>png</code> version should be retained as the “master” copy against which to rectify subsequently scanned-in version. Behind the scenes, the function downloads a series of vector map tiles from <a href="https://mapbox.com">mapbox</a>, and converts them to a <code>rasterBrick</code> object from the <a href="https://cran.r-project.org/package=raster"><code>raster</code> package</a>. This <code>rasterBrick</code> object is invisibly returned from the function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ms_generate_map.html">ms_generate_map</a></span> (<span class="st">"chennai india"</span>, <span class="dt">mapname =</span> <span class="st">"chennai"</span>)</a></code></pre></div>
<pre><code>## Successfully generated 'chennai.pdf' and 'chennai.png'</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">x</a></code></pre></div>
<pre><code>## class      : RasterBrick
## dimensions : 574, 282, 161868, 3  (nrow, ncol, ncell, nlayers)
## resolution : 76.43703, 76.43703  (x, y)
## extent     : 8921118, 8942674, 1442749, 1486624  (xmin, xmax, ymin, ymax)
## crs        : +proj=merc +a=6378137 +b=6378137
## source     : memory
## names      : layer.1, layer.2, layer.3
## min values :     101,     101,     101
## max values :     255,     255,     255</code></pre>
<p>This <code>rasterBrick</code> object contains raster information for the three colour channels of the image, and so may also be used for immediate viewing within <strong>R</strong> with <code><a href="https://rdrr.io/pkg/raster/man/plotRGB.html">raster::plotRGB(x)</a></code>.</p>
<p>Standard uses of the package should not need to explicitly access or modify these data, but it is nevertheless possible to do so, and then use a custom-modified object to produce the external <code>.pdf</code> and <code>.png</code> files by submitting the <code>rasterBrick</code> object to <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../reference/ms_generate_map.html">ms_generate_map</a></span> (<span class="dt">raster_brick =</span> x, <span class="dt">mapname =</span> <span class="st">"chennai"</span>)</a></code></pre></div>
</div>
<div id="map-rectification" class="section level2">
<h2 class="hasAnchor">
<a href="#map-rectification" class="anchor"></a>Map rectification</h2>
<p>Having produced digital maps using the <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a> function as described above, and having printed, variously drawn-on, and scanned the result back in to digital form, the package can then be used to rectify the hand-drawn markings against the original map with the <a href="https://mpadge.github.io/mapscanner/reference/ms_rectify_maps.html"><code><a href="../reference/ms_rectify_maps.html">ms_rectify_maps()</a></code></a> function, which returns the drawn-on objects as spatial objects in <a href="https://cran.r-project.org/package=sf">Simple Features (<code>sf</code>)</a> format. The only requirement is that the drawn-on objects are coloured; black or grey objects will be ignored. As described above, this has the advantage that maps may be annotated in ways not intended to be converted to spatial objects (such as adding unique identification or participant codes), through simply providing such annotations in grey or black.</p>
<p>The <a href="https://mpadge.github.io/mapscanner/reference/ms_rectify_maps.html"><code><a href="../reference/ms_rectify_maps.html">ms_rectify_maps()</a></code></a> function has only two primary arguments, specifying the names (and locations) of the original and modified map files – in that order: <code><a href="../reference/ms_rectify_maps.html">ms_rectify_maps(original, modified)</a></code>. These files should ideally be in <code>.png</code> formats, but will be auto-converted from <code>.pdf</code> if needed. The package comes with two sample maps, both in <code>.png</code> format. The first is the reference version needed for rectification, while the second has two red lines drawn upon it:</p>
<p><img src="omaha-polygons.png" width="600" height="400"></p>
<p>Converting the lines on this scanned image file is then as simple as:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">f_orig &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">f_mod &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha-polygons.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">xy &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ms_rectify_maps.html">ms_rectify_maps</a></span> (f_orig, f_mod)</a></code></pre></div>
<pre><code>## ══ mapscanner ═════════════════════════════════════════════════════════════</code></pre>
<pre><code>## ✔ Image [/home/travis/R/Library/mapscanner/extdata/omaha.png] reduced in size by factor of 2</code></pre>
<pre><code>## ❯ rectifying the two maps 
✔ rectified the two maps  
## ❯ Estimating number of items on map 
✔ Estimated number of items on map: 4
## ❯ Estimating optimal signal-to-noise threshold
✔ Estimated optimal signal-to-noise threshold
## ❯ converting to spatial format 
✔ converting to spatial format</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">xy</a></code></pre></div>
<pre><code>## Simple feature collection with 4 features and 0 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -96.11963 ymin: 41.27 xmax: -96.05145 ymax: 41.31658
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##                         geometry
## 1 POLYGON ((-96.11285 41.3165...
## 2 POLYGON ((-96.11175 41.3134...
## 3 POLYGON ((-96.0531 41.27636...
## 4 POLYGON ((-96.06135 41.2714...</code></pre>
<p>The result of <a href="https://mpadge.github.io/mapscanner/reference/ms_rectify_maps.html"><code><a href="../reference/ms_rectify_maps.html">ms_rectify_maps()</a></code></a> can be plotted using any standard option for plotting spatial data, such as through online mapping packages such as <code>mapview</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">xy<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (xy))</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">mapview<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span> (xy)</a></code></pre></div>
<p><img src="mapshot-polys.png"></p>
<div id="types-of-map-markings-and-types-of-spatial-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#types-of-map-markings-and-types-of-spatial-objects" class="anchor"></a>Types of map markings and types of spatial objects</h3>
<p>The <a href="https://mpadge.github.io/mapscanner/reference/ms_rectify_maps.html"><code><a href="../reference/ms_rectify_maps.html">ms_rectify_maps()</a></code></a> function has an additional argument, <code>type</code>, which takes the following values:</p>
<ol style="list-style-type: decimal">
<li>
<code>type = "polygons"</code> (the default), which returns the outlines traced around each individual drawn object. This tracing is pixel-based, resulting in polygons with one spatial point for each scanned pixel. This may generate spatial objects that are both overly large as well as visually pixillated. The function includes an additional <code>downsample</code> parameter which down-samples as smooths the resultant polygons by the specified multiple.</li>
<li>
<code>type = "hulls"</code>, which returns convex or concave hulls around distinct sets of contiguously marked lines, regardless of whether those lines form closed polygons or not (see function help for details).</li>
<li>
<code>type = "points"</code>, which returns single points (as geometric centroids) for each object. This is useful for identification of individual point locations regardless of the kinds of marks actually drawn on a map (dots, circles, crosses, or any shape, should all give equivalent results).</li>
</ol>
<p>The default type of <code>polygons</code> assumes – and indeed requires – that the drawn objects are <em>closed</em> polygons (as illustrated in the first of the above figures), so care must be taken to ensure this is in fact the case. Any lines that do not form closed circles will not be appropriately translated. The <code>type = "hulls"</code> parameter should be used in all other cases where areal rather than point-based results are desired, and in which lines may or do not necessarily form single closed polygons. Examples include participants being asked to colour particular areas using any desired kind of marks, enabling areal-filling scribbles can be converted to polygons representing the outer boundaries.</p>
<p>The <code>"polygon"</code> and <code>"point"</code> types are illustrated in the following maps:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">f_orig &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">f_mod &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha-polygons.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">xy &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ms_rectify_maps.html">ms_rectify_maps</a></span> (f_orig, f_mod, <span class="dt">type =</span> <span class="st">"hulls"</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">xy<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (xy))</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">mapview<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span> (xy)</a></code></pre></div>
<p><img src="mapshot-hulls.png"></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">f_orig &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">f_mod &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span> (<span class="st">"extdata"</span>, <span class="st">"omaha-polygons.png"</span>, <span class="dt">package =</span> <span class="st">"mapscanner"</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">xy &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ms_rectify_maps.html">ms_rectify_maps</a></span> (f_orig, f_mod, <span class="dt">type =</span> <span class="st">"points"</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## ✔ removed 1 anomalously detected item</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">xy<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (xy))</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">mapview<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/mapview/man/mapView.html">mapview</a></span> (xy)</a></code></pre></div>
<p><img src="mapshot-points.png"></p>
</div>
</div>
<div id="bonus-feature-polygon-aggregation" class="section level2">
<h2 class="hasAnchor">
<a href="#bonus-feature-polygon-aggregation" class="anchor"></a>Bonus Feature: Polygon Aggregation</h2>
<p>Maps are typically used in social surveys to delineate participants’ understanding or perception of particular regions or areas. In such contexts, surveys often result in numerous polygonal shapes representing different perceptions of a particular region. The <code>mapscanner</code> package provides an additional function, <code><a href="../reference/ms_aggregate_polys.html">ms_aggregate_polys()</a></code>, to aggregate polygons into a single “heat map” containing vector outlines of aggregated polygons. Each component of these aggregated polygons defines the region within which <code>n</code> polygons overlap.</p>
<p>The function is now illustrated with a slightly more complicated version of the example provided for <code><a href="../reference/ms_aggregate_polys.html">ms_aggregate_polys()</a></code>, starting by generating a series of polygons as convex hulls surrounding random points.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">5</span> <span class="co"># number of polygons</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">polys &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span> (n), <span class="cf">function</span> (i) {</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">                     nxy &lt;-<span class="st"> </span><span class="dv">20</span> <span class="co"># number of points used to generate hull</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4">                     xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span> (<span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span> (<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>nxy), <span class="dt">ncol =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">                     h &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/grDevices/chull.html">chull</a></span> (xy)</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">                     sf<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st.html">st_polygon</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span> (xy [<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (h, h [<span class="dv">1</span>]), ]))</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">            })</a>
<a class="sourceLine" id="cb23-8" data-line-number="8">polys &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/sf.html">st_sf</a></span> (<span class="dt">n =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span> (n), <span class="dt">geometry =</span> polys)</a></code></pre></div>
<p>The <code>polys</code> object is then a Simple Features (<a href="https://cran.r-project.org/package=sf"><code>sf</code></a>) <code>data.frame</code> with <code>n</code> overlapping polygons, and an additional row, <code>n</code>, to identify each polygon. The following lines then convert these to aggregated, overlapping polygons, and plot the result:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">aggr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ms_aggregate_polys.html">ms_aggregate_polys</a></span> (polys)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">polys<span class="op">$</span>type &lt;-<span class="st"> "raw polygons"</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3">aggr<span class="op">$</span>type &lt;-<span class="st"> "aggregated polygons"</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">polys &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span> (polys, aggr)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> (ggplot2)</a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span> (polys, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span> (<span class="dt">fill =</span> n)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span> () <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span> (<span class="op">~</span>type)</a></code></pre></div>
<pre><code>## Loading required namespace: dplyr</code></pre>
<pre><code>## Loading required namespace: gibble</code></pre>
<p><img src="mapscanner_files/figure-html/random-polys-1.png" width="700"></p>
<p>The left panel of that figure shows the random polygons in raw form successively overlaid upon one another. The right panel shows the aggregated contours of successive overlap from 1 to 5. The object returned from <a href="https://mpadge.github.io/mapscanner/reference/ms_aggregate_polys.html"><code><a href="../reference/ms_aggregate_polys.html">ms_aggregate_polys()</a></code></a> contains polygons ordered by level of aggregation (<code>n</code>), so the first entirely encloses the second; the second encloses the third; and so on. Particular contours can then be directly selected by filtering for desired values of <code>n</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span> (aggr [aggr<span class="op">$</span>n <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>), ], <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span> (<span class="dt">fill =</span> n)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span> ()</a></code></pre></div>
<p><img src="mapscanner_files/figure-html/aggr13-1.png" width="700"></p>
<p>Polygon aggregation enables many interesting analyses to be performed, such as relationships between aggregation level and area:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">aggr<span class="op">$</span>area &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_area</a></span> (aggr)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span> (aggr, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span> (<span class="dt">x =</span> n, <span class="dt">y =</span> area)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span> (<span class="dt">size =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="mapscanner_files/figure-html/aggr-area-1.png" width="700"></p>
<p>That result is of course (roughly) linear, because it was derived from random data. In actual usage, results such as that are likely to generate direct insight into consensus of opinion regarding how people understand particular areas.</p>
</div>
<div id="how-it-works" class="section level2">
<h2 class="hasAnchor">
<a href="#how-it-works" class="anchor"></a>How it works</h2>
<p>(This section is not necessary for package usage, and merely provides detail for those interested in how the process actually works.) <code>mapscanner</code> primarily relies on the <a href="https://github.com/jonclayden/RNiftyReg"><code>RNiftyReg</code> package</a> to rectify the images. This package is itself primarily aimed at rectifying medical scans, but also happens to be the perfect tool for the present purposes. Being an image analysis software, the library requires image objects, and not <code>pdf</code> files, which is why the <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a> function produces both kinds of files - the <code>.pdf</code> for printing and the <code>.png</code> for rectifying with the <code>RNiftyReg</code> package.</p>
<p>Rectification re-projects a scanned image back on to the coordinate system of an original image. This coordinate system translates here in to a defined bounding box (which may differ slightly from the values input into the function, due to the cutting and stitching of the vector tiles). This bounding box is embedded as meta-information in both the files produced by <a href="https://mpadge.github.io/mapscanner/reference/ms_generate_map.html"><code><a href="../reference/ms_generate_map.html">ms_generate_map()</a></code></a>; in the <code>.pdf</code> as standard meta information accessible in <strong>R</strong> like this:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">pdftools<span class="op">::</span><span class="kw"><a href="https://docs.ropensci.org/pdftools/reference/pdftools.html">pdf_info</a></span> (<span class="st">"chennai.pdf"</span>)<span class="op">$</span>keys</a></code></pre></div>
<pre><code>## $Title
## [1] "EX8921118.44521949+1442748.9088827+8942673.68719591+1486623.76311839"
## 
## $Producer
## [1] "R 3.6.0"
## 
## $Creator
## [1] "R"</code></pre>
<p>or in a terminal via <code>pdfinfo</code> (or non-linux equivalent), and embedded in the <code>.png</code> file as comment, accessible like this:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">img &lt;-<span class="st"> </span>magick<span class="op">::</span><span class="kw"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span> (<span class="st">"chennai.png"</span>)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">magick<span class="op">::</span><span class="kw"><a href="https://docs.ropensci.org/magick/reference/attributes.html">image_comment</a></span> (img)</a></code></pre></div>
<pre><code>## [1] "EX8921118.44521949+1442748.9088827+8942673.68719591+1486623.76311839"</code></pre>
<p>or in a terminal via <code>identify -verbose</code> command (itself part of the <code>imagemagick</code> library which drives the <a href="https://github.com/ropensci/magick"><code>magick</code> <strong>R</strong> package</a>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#what-does-this-package-do-for-me">What does this package do for me?</a></li>
      <li><a href="#how-do-i-use-it">How do I use it?</a></li>
      <li><a href="#mapbox-api-tokens">Mapbox API tokens</a></li>
      <li><a href="#map-generation">Map generation</a></li>
      <li><a href="#map-rectification">Map rectification</a></li>
      <li><a href="#bonus-feature-polygon-aggregation">Bonus Feature: Polygon Aggregation</a></li>
      <li><a href="#how-it-works">How it works</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Padgham, Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
